<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Booking Confirmation</title>

  <!-- Tailwind CSS for styling -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      font-family: "Inter", system-ui, sans-serif;
      background: linear-gradient(135deg, #f9fafb, #eef1f5);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #1f2937;
    }
    .fade-in {
      opacity: 0;
      transition: opacity 0.4s ease-in-out;
    }
    .fade-in.loaded {
      opacity: 1;
    }
  </style>
</head>

<body>
  <div id="container" class="max-w-md w-full bg-white p-8 rounded-2xl shadow-lg fade-in">
    <div class="flex flex-col items-center space-y-4 text-center">
      <img src="https://planyo-ch.s3.eu-central-2.amazonaws.com/site_logo_68785.png?v=90715" alt="Equine Transport UK" class="w-28" />
      <h2 class="text-2xl font-bold text-gray-800">Booking Confirmation</h2>
      <p class="text-gray-500 text-sm" id="loadingText">Loading booking details...</p>

      <div id="bookingDetails" class="hidden space-y-2 text-left text-gray-700">
        <p><strong>Booking ID:</strong> <span id="bookingID">–</span></p>
        <p><strong>Name:</strong> <span id="customerName">–</span></p>
        <p><strong>Vehicle:</strong> <span id="vehicleName">–</span></p>
        <p><strong>Start:</strong> <span id="startDate">–</span></p>
        <p><strong>End:</strong> <span id="endDate">–</span></p>
        <p><strong>Total:</strong> £<span id="totalAmount">–</span></p>
        <p><strong>Paid:</strong> £<span id="paidAmount">–</span></p>
        <p><strong>Balance:</strong> £<span id="balanceAmount">–</span></p>
      </div>

      <p id="emailNotice" class="hidden text-sm text-gray-500 mt-4">
        You will receive an email confirmation shortly.
      </p>
    </div>
  </div>

  <script>
    // ✅ Helper: read query parameters (works inside Wix iframe)
    function getQueryParams() {
      const queryString = window.location.search || parent.location.search;
      const params = {};
      new URLSearchParams(queryString).forEach((val, key) => (params[key] = val));
      return params;
    }

    async function loadBooking() {
      const container = document.getElementById("container");
      const detailsBox = document.getElementById("bookingDetails");
      const loadingText = document.getElementById("loadingText");
      const emailNotice = document.getElementById("emailNotice");

      try {
        const { bookingID } = getQueryParams();
        if (!bookingID) {
          loadingText.textContent = "No booking ID found.";
          return;
        }

        // Fetch booking details from backend
        const res = await fetch(`https://rental-backend-0kz1.onrender.com/bookingpayments/list/${bookingID}`);
        const data = await res.json();

        if (!data || !data.customer) {
          loadingText.textContent = "Booking details unavailable.";
          return;
        }

        // Fill in data
        document.getElementById("bookingID").textContent = data.bookingID || bookingID;
        document.getElementById("customerName").textContent = data.customer;
        document.getElementById("vehicleName").textContent = data.resource;
        document.getElementById("startDate").textContent = data.start || "-";
        document.getElementById("endDate").textContent = data.end || "-";
        document.getElementById("totalAmount").textContent = data.total?.toFixed(2) || "0.00";
        document.getElementById("paidAmount").textContent = data.paid?.toFixed(2) || "0.00";
        document.getElementById("balanceAmount").textContent = data.balance?.toFixed(2) || "0.00";

        // Show UI
        loadingText.classList.add("hidden");
        detailsBox.classList.remove("hidden");
        emailNotice.classList.remove("hidden");
        container.classList.add("loaded");
      } catch (err) {
        console.error("Error loading booking:", err);
        loadingText.textContent = "Error loading booking details.";
      }
    }

    loadBooking();
  </script>
</body>
</html>

